<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸©ç¨‹è¿œ - ä¸ªäººå­¦æœ¯ä¸»é¡µ</title>
    <!-- ç¼“å­˜æ§åˆ¶ï¼ˆå¼€å‘ç¯å¢ƒå»ºè®®å¯ç”¨ï¼Œç”Ÿäº§ç¯å¢ƒå¯æ³¨é‡Šæ‰ï¼‰ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <!-- Markdownæ”¯æŒ -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- æ·»åŠ  marked åŠ è½½æ£€æµ‹ -->
    <script>
        // ç­‰å¾… marked åº“åŠ è½½å®Œæˆçš„ Promise
        window.markedReady = new Promise((resolve) => {
            if (typeof marked !== 'undefined') {
                resolve();
            } else {
                const checkMarked = setInterval(() => {
                    if (typeof marked !== 'undefined') {
                        clearInterval(checkMarked);
                        resolve();
                    }
                }, 50); // æ¯ 50ms æ£€æŸ¥ä¸€æ¬¡
            }
        });
    </script>
</head>
<body>
    <!-- ==================== å›ºå®šä¾§è¾¹æ  ==================== -->
    <aside class="sidebar" id="main-sidebar">
        <div class="sidebar-header">
            <div class="sidebar-avatar">
                <img src="images/Avatar.jpg" alt="æ¸©ç¨‹è¿œ">
            </div>
            <h2>æ¸©ç¨‹è¿œ</h2>
            <p>å‰¯æ•™æˆ</p>
            <p>æµ™æ±Ÿæµ·æ´‹å¤§å­¦</p>
        </div>

        <nav>
            <ul class="nav-menu">
                <!-- ============ é¦–é¡µ ============ -->
                <!--
                <li class="nav-item">
                    <a href="javascript:void(0)" onclick="loadPage('pages/home.html')" class="nav-link active">
                        <i>ğŸ </i> é¦–é¡µ
                    </a>
                </li>
                -->

                <li class="nav-item">
                    <a href="javascript:void(0)" onclick="loadPage('pages/new-page.html')" class="nav-link active">
                        <i>ğŸ </i> é¦–é¡µ
                    </a>
                </li>

                <!-- ============ ç ”ç©¶æ–¹å‘ï¼ˆå¸¦å­èœå•ï¼‰ ============ -->
                <li class="nav-item has-submenu">
                    <a href="javascript:void(0)" class="nav-link" onclick="toggleSubmenu(this)">
                        <i>ğŸ”¬</i> ç ”ç©¶æ–¹å‘
                    </a>
                    <ul class="sub-menu">
                        <li><a href="javascript:void(0)" onclick="loadPage('pages/research-ai.html')">äººå·¥æ™ºèƒ½ä¸æœºå™¨äºº</a></li>
                        <li><a href="javascript:void(0)" onclick="loadPage('pages/research-cv.html')">è®¡ç®—æœºè§†è§‰</a></li>
                        <!-- æ·»åŠ æ–°ç ”ç©¶æ–¹å‘ï¼šå¤åˆ¶ä¸Šé¢ä¸€è¡Œï¼Œä¿®æ”¹æ–‡ä»¶åå’Œæ ‡é¢˜ -->
                    </ul>
                </li>

                <!-- ============ ç ”ç©¶æˆæœ ============ -->
                <li class="nav-item has-submenu">
                    <a href="javascript:void(0)" class="nav-link" onclick="toggleSubmenu(this)">
                        <i>ğŸ“š</i> ç ”ç©¶æˆæœ
                    </a>
                    <ul class="sub-menu">
                        <li><a href="javascript:void(0)" onclick="loadPage('pages/achievements-all.html')">æ€»æˆæœ</a></li>
                        <li><a href="javascript:void(0)" onclick="loadPage('pages/achievements-journals.html')">æœŸåˆŠè®ºæ–‡</a></li>
                        <li><a href="javascript:void(0)" onclick="loadPage('pages/achievements-conferences.html')">ä¼šè®®è®ºæ–‡</a></li>
                        <li><a href="javascript:void(0)" onclick="loadPage('pages/achievements-patents.html')">ä¸“åˆ©</a></li>
                    </ul>
                </li>

                <!-- ============ æ•™å­¦å·¥ä½œ ============ -->
                <li class="nav-item has-submenu">
                    <a href="javascript:void(0)" class="nav-link" onclick="toggleSubmenu(this)">
                        <i>ğŸ“–</i> æ•™å­¦å·¥ä½œ
                    </a>
                    <ul class="sub-menu">
                        <li><a href="javascript:void(0)" onclick="loadPage('pages/teaching-courses.html')">æˆè¯¾è¯¾ç¨‹</a></li>
                        <li><a href="javascript:void(0)" onclick="loadPage('pages/teaching-textbooks.html')">ç¼–å†™æ•™æ</a></li>
                    </ul>
                </li>

                <!-- ============ å­¦ç”ŸæŒ‡å¯¼ ============ -->
                <li class="nav-item">
                    <a href="javascript:void(0)" onclick="loadPage('pages/students.html')" class="nav-link">
                        <i>ğŸ‘¨â€ğŸ“</i> å­¦ç”ŸæŒ‡å¯¼
                    </a>
                </li>

                <!-- ============ ç«èµ›æŒ‡å¯¼ ============ -->
                <li class="nav-item">
                    <a href="javascript:void(0)" onclick="loadPage('pages/competitions.html')" class="nav-link">
                        <i>ğŸ†</i> ç«èµ›æŒ‡å¯¼
                    </a>
                </li>

                <!-- ============ è£èª‰å¥–é¡¹ ============ -->
                <li class="nav-item">
                    <a href="javascript:void(0)" onclick="loadPage('pages/honors.html')" class="nav-link">
                        <i>ğŸŒŸ</i> è£èª‰å¥–é¡¹
                    </a>
                </li>

                <!-- ============ è”ç³»æ–¹å¼ ============ -->
                <li class="nav-item">
                    <a href="javascript:void(0)" onclick="loadPage('pages/contact.html')" class="nav-link">
                        <i>ğŸ“§</i> è”ç³»æ–¹å¼
                    </a>
                </li>

                <!-- ============ æ·»åŠ æ–°èœå•ç¤ºä¾‹ï¼ˆå·²æ³¨é‡Šï¼‰ ============ -->
                <!--
                <li class="nav-item">
                    <a href="javascript:void(0)" onclick="loadPage('pages/new-page.html')" class="nav-link">
                        <i>ğŸ“„</i> æ–°é¡µé¢
                    </a>
                </li>
                -->
            </ul>
        </nav>

        <!-- ç»Ÿè®¡ä¿¡æ¯ï¼ˆè‡ªåŠ¨è®¡æ•°ï¼‰ -->
        <div class="sidebar-stats">
            <div class="stat-item">
                <span class="stat-number" id="total-papers">0</span>
                <span class="stat-label">è®ºæ–‡</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="total-patents">0</span>
                <span class="stat-label">ä¸“åˆ©</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="total-students">0</span>
                <span class="stat-label">å­¦ç”Ÿ</span>
            </div>
        </div>

        <!-- éšè—å·¥å…·æŒ‰é’®ï¼ˆè¿ç»­ç‚¹å‡»ç»Ÿè®¡åŒºåŸŸ3æ¬¡æ˜¾ç¤ºï¼‰ -->
        <div class="hidden-tools" id="hidden-tools" style="display: none;">
            <button class="tool-btn" onclick="downloadTimeline()" title="ç”Ÿæˆå¹¶ä¸‹è½½å­¦æœ¯æ—¶é—´çº¿">
                ğŸ“… ç”Ÿæˆæ—¶é—´çº¿
            </button>
            <button class="tool-btn" onclick="downloadAcademicCV()" title="ç”Ÿæˆå¹¶ä¸‹è½½å­¦æœ¯ç®€å†">
                ğŸ“„ ç”Ÿæˆç®€å†
            </button>
            <button class="tool-btn" onclick="toggleHiddenTools()" title="éšè—å·¥å…·æ ">
                âŒ éšè—
            </button>
        </div>
    </aside>

    <!-- ==================== ä¸»å†…å®¹åŒºåŸŸï¼ˆåŠ¨æ€åŠ è½½ï¼‰ ==================== -->
    <main class="main-content" id="main-content">
        <div class="container" id="page-container">
            <!-- å†…å®¹å°†ä»pages/ç›®å½•çš„HTMLæ–‡ä»¶åŠ è½½ -->
            <div class="loading">åŠ è½½ä¸­...</div>
        </div>
    </main>

    <!-- ==================== JavaScript ==================== -->
    <!-- å…¨å±€æ•°æ®ç®¡ç† -->
    <script src="assets/js/global-data.js"></script>

    <!-- é¡µé¢åŠ è½½å™¨ -->
    <script>
        // é¡µé¢åŠ è½½å‡½æ•°
        async function loadPage(pagePath) {
            const container = document.getElementById('page-container');

            try {
                container.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';

                const response = await fetch(pagePath + '?t=' + Date.now()); // æ·»åŠ æ—¶é—´æˆ³é˜²æ­¢ç¼“å­˜
                if (!response.ok) throw new Error('é¡µé¢åŠ è½½å¤±è´¥');

                let html = await response.text();

                // ç­‰å¾… marked åŠ è½½å®Œæˆåå†å¤„ç† Markdown
                await window.markedReady;
                html = await processMarkdown(html);

                container.innerHTML = html;

                // æ‰§è¡Œé¡µé¢ä¸­çš„è„šæœ¬ï¼ˆå¦‚æœæœ‰ï¼‰
                executePageScripts(container);

                // æ›´æ–°æ´»åŠ¨é“¾æ¥çŠ¶æ€
                updateActiveLink(pagePath);

                // æ»šåŠ¨åˆ°é¡¶éƒ¨
                window.scrollTo(0, 0);

            } catch (error) {
                // æ£€æŸ¥æ˜¯å¦æ˜¯æœ¬åœ°æ–‡ä»¶åè®®é”™è¯¯
                const isLocalFile = window.location.protocol === 'file:';

                container.innerHTML = `
                    <div class="error-message">
                        <h2>âš ï¸ é¡µé¢åŠ è½½å¤±è´¥</h2>
                        <p>æ— æ³•åŠ è½½ ${pagePath}</p>
                        <p class="error-detail">${error.message}</p>
                        ${isLocalFile ? `
                            <div class="local-dev-notice">
                                <h3>ğŸ’¡ æœ¬åœ°å¼€å‘æç¤º</h3>
                                <p>æ‚¨æ­£åœ¨ä½¿ç”¨æœ¬åœ°æ–‡ä»¶åè®®(file://)ï¼Œæµè§ˆå™¨å®‰å…¨ç­–ç•¥ä¸å…è®¸åŠ è½½å…¶ä»–æ–‡ä»¶ã€‚</p>
                                <p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
                                <ol style="text-align: left; display: inline-block; margin: 20px auto;">
                                    <li>ä½¿ç”¨æœ¬åœ°æœåŠ¡å™¨è¿è¡Œï¼š
                                        <ul>
                                            <li>Python 3: <code>python -m http.server 8000</code></li>
                                            <li>Python 2: <code>python -m SimpleHTTPServer 8000</code></li>
                                            <li>Node.js: <code>npx http-server</code></li>
                                        </ul>
                                    </li>
                                    <li>ç„¶åè®¿é—®: <code>http://localhost:8000</code></li>
                                </ol>
                                <p style="margin-top: 20px;">æˆ–è€…ç›´æ¥å°†ç½‘ç«™éƒ¨ç½²åˆ°GitHub PagesæŸ¥çœ‹æ•ˆæœã€‚</p>
                            </div>
                        ` : ''}
                    </div>
                `;
            }
        }

        // å¤„ç†Markdownå†…å®¹ï¼ˆå¼‚æ­¥ç‰ˆæœ¬ï¼Œç¡®ä¿ marked å·²åŠ è½½ï¼‰
        async function processMarkdown(html) {
            // ç¡®ä¿ marked å·²åŠ è½½
            if (typeof marked === 'undefined') {
                console.error('âŒ marked åº“æœªåŠ è½½');
                return html;
            }

            // æŸ¥æ‰¾æ‰€æœ‰ <markdown> æ ‡ç­¾
            const markdownRegex = /<markdown>([\s\S]*?)<\/markdown>/g;
            return html.replace(markdownRegex, (match, content) => {
                try {
                    return marked.parse(content.trim());
                } catch (error) {
                    console.error('âŒ Markdown è§£æé”™è¯¯:', error);
                    return `<div class="error">Markdown è§£æå¤±è´¥: ${error.message}</div>`;
                }
            });
        }

        // æ‰§è¡Œé¡µé¢ä¸­çš„è„šæœ¬
        function executePageScripts(container) {
            const scripts = container.querySelectorAll('script');
            scripts.forEach((oldScript) => {
                const newScript = document.createElement('script');

                // å¤åˆ¶æ‰€æœ‰å±æ€§
                Array.from(oldScript.attributes).forEach((attr) => {
                    newScript.setAttribute(attr.name, attr.value);
                });

                // å¦‚æœæ˜¯å†…è”è„šæœ¬ï¼Œå¤åˆ¶å†…å®¹å¹¶æ‰§è¡Œ
                if (!oldScript.src) {
                    newScript.textContent = oldScript.textContent;
                }

                // æ›¿æ¢æ—§è„šæœ¬ä»¥è§¦å‘æ‰§è¡Œ
                oldScript.parentNode.replaceChild(newScript, oldScript);
            });
        }

        // æ›´æ–°æ´»åŠ¨é“¾æ¥çŠ¶æ€
        function updateActiveLink(pagePath) {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });

            document.querySelectorAll(`a[onclick*="${pagePath}"]`).forEach(link => {
                link.classList.add('active');
            });
        }

        // åˆ‡æ¢å­èœå•
        function toggleSubmenu(element) {
            const parent = element.parentElement;
            const wasActive = parent.classList.contains('active');

            // å…³é—­æ‰€æœ‰å­èœå•
            document.querySelectorAll('.nav-item.has-submenu').forEach(item => {
                item.classList.remove('active');
            });

            // å¦‚æœä¹‹å‰ä¸æ˜¯activeï¼Œåˆ™æ‰“å¼€
            if (!wasActive) {
                parent.classList.add('active');
            }
        }

        // é¡µé¢åŠ è½½æ—¶åŠ è½½é¦–é¡µ
        window.addEventListener('DOMContentLoaded', () => {
            loadPage('pages/home.html');
            updateStats(); // æ›´æ–°ç»Ÿè®¡æ•°æ®
            setupHiddenTools(); // è®¾ç½®éšè—å·¥å…·è§¦å‘å™¨
        });

        // ==================== éšè—å·¥å…·æ§åˆ¶ ====================
        let toolClickCount = 0;
        let toolClickTimer = null;

        function setupHiddenTools() {
            const statsDiv = document.querySelector('.sidebar-stats');
            if (!statsDiv) return;

            statsDiv.style.cursor = 'pointer';
            statsDiv.addEventListener('click', () => {
                toolClickCount++;

                if (toolClickTimer) clearTimeout(toolClickTimer);

                if (toolClickCount >= 3) {
                    toolClickCount = 0;
                    toggleHiddenTools();
                } else {
                    toolClickTimer = setTimeout(() => {
                        toolClickCount = 0;
                    }, 1000);
                }
            });
        }

        function toggleHiddenTools() {
            const toolsDiv = document.getElementById('hidden-tools');
            if (toolsDiv.style.display === 'none') {
                toolsDiv.style.display = 'block';
                console.log('ğŸ”“ éšè—å·¥å…·å·²æ¿€æ´»');
            } else {
                toolsDiv.style.display = 'none';
                console.log('ğŸ”’ éšè—å·¥å…·å·²éšè—');
            }
        }
    </script>

    <style>
        /* ä¾§è¾¹æ ç»Ÿè®¡ä¿¡æ¯æ ·å¼ */
        .sidebar-stats {
            margin-top: 30px;
            padding: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-around;
            gap: 10px;
        }

        .stat-item {
            text-align: center;
            flex: 1;
        }

        .stat-number {
            display: block;
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--secondary-color);
            margin-bottom: 5px;
        }

        .stat-label {
            display: block;
            font-size: 0.85rem;
            color: rgba(255,255,255,0.7);
        }

        /* åŠ è½½å’Œé”™è¯¯æç¤º */
        .loading {
            text-align: center;
            padding: 100px 20px;
            font-size: 1.2rem;
            color: #7f8c8d;
        }

        .error-message {
            text-align: center;
            padding: 60px 20px;
        }

        .error-message h2 {
            color: #e74c3c;
            margin-bottom: 20px;
        }

        .error-detail {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        /* æ´»åŠ¨é“¾æ¥æ ·å¼ */
        .nav-link.active {
            background: rgba(255,255,255,0.1);
            border-left: 3px solid var(--secondary-color);
        }

        /* éšè—å·¥å…·æ ·å¼ */
        .hidden-tools {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .tool-btn {
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            background: rgba(255,255,255,0.15);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tool-btn:hover {
            background: rgba(255,255,255,0.25);
            border-color: var(--secondary-color);
            transform: translateX(5px);
        }

        .tool-btn:active {
            transform: translateX(5px) scale(0.98);
        }

        /* æœ¬åœ°å¼€å‘æç¤ºæ ·å¼ */
        .local-dev-notice {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            color: #856404;
        }

        .local-dev-notice h3 {
            color: #856404;
            margin-bottom: 15px;
        }

        .local-dev-notice code {
            background: #fff;
            padding: 3px 8px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #c7254e;
        }

        .local-dev-notice ol,
        .local-dev-notice ul {
            margin: 10px 0;
        }

        .local-dev-notice li {
            margin: 8px 0;
        }
    </style>
</body>
</html>
